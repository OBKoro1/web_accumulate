{"remainingRequest":"/Users/koro/work/web_my/web_accumulate/node_modules/vue-loader/lib/index.js??ref--1-1!/Users/koro/work/web_my/web_accumulate/node_modules/vuepress/lib/webpack/markdownLoader.js??ref--1-2!/Users/koro/work/web_my/web_accumulate/docs/accumulate/electron/electron-terminal-demo.md?vue&type=template&id=c5b6cb2e&","dependencies":[{"path":"/Users/koro/work/web_my/web_accumulate/docs/accumulate/electron/electron-terminal-demo.md","mtime":1610439313671},{"path":"/Users/koro/work/web_my/web_accumulate/node_modules/cache-loader/dist/cjs.js","mtime":1557296864520},{"path":"/Users/koro/work/web_my/web_accumulate/node_modules/vue-loader/lib/loaders/templateLoader.js","mtime":1557296867191},{"path":"/Users/koro/work/web_my/web_accumulate/node_modules/cache-loader/dist/cjs.js","mtime":1557296864520},{"path":"/Users/koro/work/web_my/web_accumulate/node_modules/vue-loader/lib/index.js","mtime":1557296867190},{"path":"/Users/koro/work/web_my/web_accumulate/node_modules/vuepress/lib/webpack/markdownLoader.js","mtime":1557296867284}],"contextDependencies":[],"result":["\n<div class=\"content\"><h1 id=\"从零开始带你写一个运行命令行的终端-手把手教学\"><a class=\"header-anchor\" href=\"#从零开始带你写一个运行命令行的终端-手把手教学\" aria-hidden=\"true\">#</a> 从零开始带你写一个运行命令行的终端[手把手教学]</h1>\n<p><img src=\"https://raw.githubusercontent.com/OBKoro1/articleImg_src/master/2021/electron-terminal/electron-terminal-img.jpg\" alt=\"\"></p>\n<h3 id=\"前言\"><a class=\"header-anchor\" href=\"#前言\" aria-hidden=\"true\">#</a> 前言</h3>\n<p><code>Electron</code>很出名，很多人可能了解过，知道它是用来开发桌面端的应用，但是一直没有在项目中实践过，缺乏练手的实践项目。</p>\n<p>很多开源的命令行终端都是使用<code>Electron</code>来开发的，本文将从零开始手把手的教大家用<code>Electron</code>写一个命令行终端。</p>\n<p>作为一个完整的实战项目示例，该终端demo也将集成到<code>Electron</code>开源学习项目<a href=\"https://github.com/tal-tech/electron-playground\" target=\"_blank\" rel=\"noopener noreferrer\">electron-playground<OutboundLink/></a>中，目前这个项目拥有700+ Star⭐️，它最大的特点是所见即所得的演示<code>Electron</code>的各种特性，帮助大家快速学习、上手<code>Electron</code>。</p>\n<p>大家跟着本文一起来试试Electron吧~</p>\n<h2 id=\"终端效果\"><a class=\"header-anchor\" href=\"#终端效果\" aria-hidden=\"true\">#</a> 终端效果</h2>\n<p>开源地址: <a href=\"https://github.com/OBKoro1/electron-terminal-demo\" target=\"_blank\" rel=\"noopener noreferrer\">electron-terminal-demo<OutboundLink/></a></p>\n<p><strong>giit提交代码演示</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/OBKoro1/articleImg_src/master/2021/electron-terminal/electron-terminal-git.gif\" alt=\"\"></p>\n<h3 id=\"目录\"><a class=\"header-anchor\" href=\"#目录\" aria-hidden=\"true\">#</a> 目录</h3>\n<ol>\n<li>\n<p>初始化项目。</p>\n</li>\n<li>\n<p>项目目录结构</p>\n</li>\n<li>\n<p>Electron启动入口index-创建窗口</p>\n</li>\n<li>\n<p>进程通信类-processMessage。</p>\n</li>\n<li>\n<p>窗口html页面-命令行面板</p>\n</li>\n<li>\n<p>命令行面板做了哪些事情</p>\n<ul>\n<li>核心方法：child_process.spawn-执行命令行监听命令行的输出</li>\n<li>stderr不能直接识别为命令行执行错误</li>\n<li>命令行终端执行命令保存输出信息的核心代码</li>\n<li>html完整代码</li>\n<li>命令行终端的更多细节</li>\n</ul>\n</li>\n<li>\n<p>下载试玩</p>\n<ul>\n<li>项目演示</li>\n<li>项目地址</li>\n<li>启动与调试</li>\n</ul>\n</li>\n<li>\n<p>小结</p>\n</li>\n</ol>\n<h3 id=\"初始化项目\"><a class=\"header-anchor\" href=\"#初始化项目\" aria-hidden=\"true\">#</a> 初始化项目</h3>\n<!--beforebegin--><div class=\"language-js line-numbers-mode\"><!--afterbegin--><pre v-pre class=\"language-js\"><code>npm init\nnpm install electron <span class=\"token operator\">-</span><span class=\"token constant\">D</span>\n</code></pre>\n<div class=\"line-numbers-wrapper\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br></div><!--beforeend--></div><!--afterend--><p>如果Electron安装不上去，需要添加一个<code>.npmrc</code>文件,来修改<code>Electron</code>的安装地址,文件内容如下：</p>\n<!--beforebegin--><div class=\"language- line-numbers-mode\"><!--afterbegin--><pre v-pre class=\"language-text\"><code>registry=https://registry.npm.taobao.org/\nelectron_mirror=https://npm.taobao.org/mirrors/electron/\nchromedriver_cdnurl=https://npm.taobao.org/mirrors/chromedriver\n</code></pre>\n<div class=\"line-numbers-wrapper\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br></div><!--beforeend--></div><!--afterend--><p>修改一下<code>package.json</code>的入口<code>main</code>和<code>scripts</code>选项, 现在<code>package.json</code>长这样，很简洁:</p>\n<!--beforebegin--><div class=\"language-js line-numbers-mode\"><!--afterbegin--><pre v-pre class=\"language-js\"><code><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"electron-terminal\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"version\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1.0.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"main\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"./src/index.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"scripts\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"start\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"electron .\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"devDependencies\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"electron\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"^11.1.1\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<div class=\"line-numbers-wrapper\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br></div><!--beforeend--></div><!--afterend--><h3 id=\"项目目录结构\"><a class=\"header-anchor\" href=\"#项目目录结构\" aria-hidden=\"true\">#</a> 项目目录结构</h3>\n<p>我们最终实现的项目将是下面这样子的，页面css文件不算的话，我们只需要实现src下面的三个文件即可。</p>\n<!--beforebegin--><div class=\"language-js line-numbers-mode\"><!--afterbegin--><pre v-pre class=\"language-js\"><code><span class=\"token punctuation\">.</span>\n├── <span class=\"token punctuation\">.</span>vscode <span class=\"token comment\">// 使用vscode的调试功能启动项目</span>\n├── node_dodules\n├── src\n│   ├── index<span class=\"token punctuation\">.</span>js <span class=\"token comment\">// Electron启动入口-创建窗口</span>\n│   └── processMessage<span class=\"token punctuation\">.</span>js <span class=\"token comment\">// 主进程和渲染进程通信类-进程通信、监听时间</span>\n│   └── index<span class=\"token punctuation\">.</span>html <span class=\"token comment\">// 窗口html页面-命令行面板、执行命令并监听输出</span>\n│   └── index<span class=\"token punctuation\">.</span>css <span class=\"token comment\">// 窗口html的css样式 这部分不写</span>\n├── <span class=\"token keyword\">package</span><span class=\"token punctuation\">.</span>json\n└── <span class=\"token punctuation\">.</span>npmrc <span class=\"token comment\">// 修改npm安装包的地址</span>\n└── <span class=\"token punctuation\">.</span>gitignore\n</code></pre>\n<div class=\"line-numbers-wrapper\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br></div><!--beforeend--></div><!--afterend--><h3 id=\"electron启动入口index-创建窗口\"><a class=\"header-anchor\" href=\"#electron启动入口index-创建窗口\" aria-hidden=\"true\">#</a> Electron启动入口index-创建窗口</h3>\n<ol>\n<li>创建窗口, 赋予窗口直接使用node的能力。</li>\n<li>窗口加载本地html页面</li>\n<li>加载主线程和渲染进程通信逻辑</li>\n</ol>\n<!--beforebegin--><div class=\"language-js line-numbers-mode\"><!--afterbegin--><pre v-pre class=\"language-js\"><code><span class=\"token comment\">// ./src/index.js</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> app<span class=\"token punctuation\">,</span> BrowserWindow <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'electron'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> processMessage <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./processMessage'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 创建窗口</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">createWindow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 创建窗口</span>\n  <span class=\"token keyword\">const</span> win <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BrowserWindow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    width<span class=\"token punctuation\">:</span> <span class=\"token number\">800</span><span class=\"token punctuation\">,</span>\n    height<span class=\"token punctuation\">:</span> <span class=\"token number\">600</span><span class=\"token punctuation\">,</span>\n    webPreferences<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      nodeIntegration<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 页面直接使用node的能力 用于引入node模块 执行命令</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 加载本地页面</span>\n  win<span class=\"token punctuation\">.</span><span class=\"token function\">loadFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/index.html'</span><span class=\"token punctuation\">)</span>\n  win<span class=\"token punctuation\">.</span>webContents<span class=\"token punctuation\">.</span><span class=\"token function\">openDevTools</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 打开控制台</span>\n  <span class=\"token comment\">// 主线程和渲染进程通信</span>\n  <span class=\"token keyword\">const</span> ProcessMessage <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">processMessage</span><span class=\"token punctuation\">(</span>win<span class=\"token punctuation\">)</span>\n  ProcessMessage<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// app ready 创建窗口</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">whenReady</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>createWindow<span class=\"token punctuation\">)</span>\n</code></pre>\n<div class=\"line-numbers-wrapper\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br><span class=\"line-number\">12</span><br><span class=\"line-number\">13</span><br><span class=\"line-number\">14</span><br><span class=\"line-number\">15</span><br><span class=\"line-number\">16</span><br><span class=\"line-number\">17</span><br><span class=\"line-number\">18</span><br><span class=\"line-number\">19</span><br><span class=\"line-number\">20</span><br><span class=\"line-number\">21</span><br><span class=\"line-number\">22</span><br><span class=\"line-number\">23</span><br><span class=\"line-number\">24</span><br></div><!--beforeend--></div><!--afterend--><h3 id=\"进程通信类-processmessage\"><a class=\"header-anchor\" href=\"#进程通信类-processmessage\" aria-hidden=\"true\">#</a> 进程通信类-processMessage</h3>\n<p>electron分为主进程和渲染进程，因为进程不同，在各种事件发生的对应时机需要相互通知来执行一些功能。</p>\n<p>这个类就是用于它们之间的通信的，electron通信这部分封装的很简洁了，照着用就可以了。</p>\n<!--beforebegin--><div class=\"language-js line-numbers-mode\"><!--afterbegin--><pre v-pre class=\"language-js\"><code><span class=\"token comment\">// ./src/processMessage.js</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> ipcMain <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'electron'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ProcessMessage</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * 进程通信\n   * @param {*} win 创建的窗口\n   */</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>win<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>win <span class=\"token operator\">=</span> win\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">watch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// 监听渲染进程事件通信</span>\n  <span class=\"token function\">watch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 页面准备好了</span>\n    ipcMain<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'page-ready'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">sendFocus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// 监听窗口、app、等模块的事件</span>\n  <span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 监听窗口是否聚焦</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>win<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'focus'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">sendFocus</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>win<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'blur'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">sendFocus</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">/**\n   * 窗口聚焦事件发送\n   * @param {*} isActive 是否聚焦\n   */</span>\n  <span class=\"token function\">sendFocus</span><span class=\"token punctuation\">(</span>isActive<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 主线程发送事件给窗口</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>win<span class=\"token punctuation\">.</span>webContents<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'win-focus'</span><span class=\"token punctuation\">,</span> isActive<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> ProcessMessage\n</code></pre>\n<div class=\"line-numbers-wrapper\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br><span class=\"line-number\">12</span><br><span class=\"line-number\">13</span><br><span class=\"line-number\">14</span><br><span class=\"line-number\">15</span><br><span class=\"line-number\">16</span><br><span class=\"line-number\">17</span><br><span class=\"line-number\">18</span><br><span class=\"line-number\">19</span><br><span class=\"line-number\">20</span><br><span class=\"line-number\">21</span><br><span class=\"line-number\">22</span><br><span class=\"line-number\">23</span><br><span class=\"line-number\">24</span><br><span class=\"line-number\">25</span><br><span class=\"line-number\">26</span><br><span class=\"line-number\">27</span><br><span class=\"line-number\">28</span><br><span class=\"line-number\">29</span><br><span class=\"line-number\">30</span><br><span class=\"line-number\">31</span><br><span class=\"line-number\">32</span><br><span class=\"line-number\">33</span><br><span class=\"line-number\">34</span><br><span class=\"line-number\">35</span><br><span class=\"line-number\">36</span><br><span class=\"line-number\">37</span><br><span class=\"line-number\">38</span><br><span class=\"line-number\">39</span><br><span class=\"line-number\">40</span><br><span class=\"line-number\">41</span><br></div><!--beforeend--></div><!--afterend--><h2 id=\"窗口html页面-命令行面板\"><a class=\"header-anchor\" href=\"#窗口html页面-命令行面板\" aria-hidden=\"true\">#</a> 窗口html页面-命令行面板</h2>\n<p>在创建窗口的时候，我们赋予了窗口使用node的能力, 可以在html中直接使用node模块。</p>\n<p>所以我们不需要通过进程通信的方式来执行命令和渲染输出，可以直接在一个文件里面完成。</p>\n<p><strong>终端的核心在于执行命令，渲染命令行输出，保存命令行的输出</strong>。</p>\n<p>这些都在这个文件里面实现了，代码行数不到250行。</p>\n<h2 id=\"命令行面板做了哪些事情\"><a class=\"header-anchor\" href=\"#命令行面板做了哪些事情\" aria-hidden=\"true\">#</a> 命令行面板做了哪些事情</h2>\n<ul>\n<li>\n<p>页面: 引入vue、element,css文件来处理页面</p>\n</li>\n<li>\n<p>template模板-渲染当前命令行执行的输出以及历史命令行的执行输出</p>\n</li>\n<li>\n<p><strong>核心</strong>:执行命令监听命令行输出</p>\n<ul>\n<li>执行命令并监听执行命令的输出，同步渲染输出。</li>\n<li>执行完毕，保存命令行输出的信息。</li>\n<li>渲染历史命令行输出。</li>\n<li>对一些命令进行特殊处理，比如下面的细节处理。</li>\n</ul>\n</li>\n<li>\n<p>围绕执行命令行的细节处理</p>\n<ul>\n<li>识别cd，根据系统保存cd路径</li>\n<li>识别clear清空所有输出。</li>\n<li>执行成功与失败的箭头图标展示。</li>\n<li>聚焦窗口，聚焦输入。</li>\n<li>命令执行完毕滚动底部。</li>\n<li>等等细节。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"核心方法：child-process-spawn-执行命令行监听命令行的输出\"><a class=\"header-anchor\" href=\"#核心方法：child-process-spawn-执行命令行监听命令行的输出\" aria-hidden=\"true\">#</a> 核心方法：child_process.spawn-执行命令行监听命令行的输出</h3>\n<h4 id=\"child-process-spawn介绍\"><a class=\"header-anchor\" href=\"#child-process-spawn介绍\" aria-hidden=\"true\">#</a> child_process.spawn介绍</h4>\n<p><code>spawn</code>是node子进程模块<code>child_process</code>提供的一个异步方法。</p>\n<p><strong>它的作用是执行命令并且可以实时监听命令行执行的输出</strong>。</p>\n<p>当我第一次知道这个API的时候，我就感觉这个方法简直是为命令行终端量身定做的。</p>\n<p>终端的核心也是执行命令行，并且实时输出命令行执行期间的信息。</p>\n<p>下面就来看看它的使用方式。</p>\n<h4 id=\"使用方式\"><a class=\"header-anchor\" href=\"#使用方式\" aria-hidden=\"true\">#</a> 使用方式</h4>\n<!--beforebegin--><div class=\"language-js line-numbers-mode\"><!--afterbegin--><pre v-pre class=\"language-js\"><code><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> spawn <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'child_process'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> ls <span class=\"token operator\">=</span> <span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ls'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  encoding<span class=\"token punctuation\">:</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span>\n  cwd<span class=\"token punctuation\">:</span> process<span class=\"token punctuation\">.</span><span class=\"token function\">cwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 执行命令路径</span>\n  shell<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 使用shell命令</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 监听标准输出</span>\nls<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`stdout: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 监听标准错误</span>\nls<span class=\"token punctuation\">.</span>stderr<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`stderr: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 子进程关闭事件</span>\nls<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`子进程退出，退出码 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>code<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<div class=\"line-numbers-wrapper\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br><span class=\"line-number\">12</span><br><span class=\"line-number\">13</span><br><span class=\"line-number\">14</span><br><span class=\"line-number\">15</span><br><span class=\"line-number\">16</span><br><span class=\"line-number\">17</span><br><span class=\"line-number\">18</span><br><span class=\"line-number\">19</span><br><span class=\"line-number\">20</span><br><span class=\"line-number\">21</span><br></div><!--beforeend--></div><!--afterend--><p>api的使用很简单，但是终端信息的输出，需要很多细节的处理，比如下面这个。</p>\n<h3 id=\"stderr不能直接识别为命令行执行错误\"><a class=\"header-anchor\" href=\"#stderr不能直接识别为命令行执行错误\" aria-hidden=\"true\">#</a> stderr不能直接识别为命令行执行错误</h3>\n<p><code>stderr</code>虽然是标准错误输出，但里面的信息不全是错误的信息，不同的工具会有不同的处理。</p>\n<p>对于<code>git</code>来说，有很多命令行操作的输出信息都输出在<code>stederr</code>上。</p>\n<p>比如<code>git clone</code>、<code>git push</code>等，信息输出在<code>stederr</code>中，我们不能将其视为错误。</p>\n<p><code>git</code>总是将<strong>详细的状态信息和进度报告</strong>，以及只读信息，发送给<code>stederr</code>。</p>\n<p>具体细节可以查看<a href=\"https://juejin.cn/post/6844903676792815629\" target=\"_blank\" rel=\"noopener noreferrer\">git stderr(错误流)探秘<OutboundLink/></a>等资料。</p>\n<p>暂时还不清楚其他工具/命令行也有没有类似的操作，但是很明显我们不能将<code>stederr</code>的信息视为错误的信息。</p>\n<p>PS: 对于git如果想提供更好的支持，需要根据不同的<code>git</code>命令进行特殊处理，比如对下面<code>clear</code>命令和<code>cd</code>命令的特殊处理。</p>\n<p><strong>根据子进程close事件判断命令行是否执行成功</strong></p>\n<p>我们应该检测<code>close</code>事件的退出码<code>code</code>, 如果<code>code</code>为0则表示命令行执行成功，否则即为失败。</p>\n<h3 id=\"命令行终端执行命令保存输出信息的核心代码\"><a class=\"header-anchor\" href=\"#命令行终端执行命令保存输出信息的核心代码\" aria-hidden=\"true\">#</a> 命令行终端执行命令保存输出信息的核心代码</h3>\n<p>下面这段是命令行面板的核心代码，我贴一下大家重点看一下，</p>\n<p>其他部分都是一些细节、优化体验、状态处理这样的代码，下面会将完整的html贴上来。</p>\n<!--beforebegin--><div class=\"language-js line-numbers-mode\"><!--afterbegin--><pre v-pre class=\"language-js\"><code><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> spawn <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'child_process'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 使用node child_process模块</span>\n<span class=\"token comment\">// 执行命令行</span>\n<span class=\"token function\">actionCommand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 处理command命令 </span>\n  <span class=\"token keyword\">const</span> command <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>command<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isClear</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>command <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n  <span class=\"token comment\">// 执行命令行</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>action <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handleCommand <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">cdCommand</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> ls <span class=\"token operator\">=</span> <span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handleCommand<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    encoding<span class=\"token punctuation\">:</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span>\n    cwd<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 执行命令路径</span>\n    shell<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 使用shell命令</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 监听命令行执行过程的输出</span>\n  ls<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>commandMsg<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`stdout: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>value<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  ls<span class=\"token punctuation\">.</span>stderr<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>stderrMsgHandle<span class=\"token punctuation\">)</span>\n  ls<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>closeCommandAction<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token comment\">// 错误或详细状态进度报告 比如 git push</span>\n<span class=\"token function\">stderrMsgHandle</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`stderr: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>commandMsg<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`stderr: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token comment\">// 执行完毕 保存信息 更新状态</span>\n<span class=\"token function\">closeCommandAction</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 保存执行信息</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>commandArr<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    code<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 是否执行成功</span>\n    path<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 执行路径</span>\n    command<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>command<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 执行命令</span>\n    commandMsg<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>commandMsg<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\r'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 执行信息</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 清空</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updatePath</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handleCommand<span class=\"token punctuation\">,</span> code<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">commandFinish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token string\">`子进程退出，退出码 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>code<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, 运行</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>code <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">'成功'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'失败'</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<div class=\"line-numbers-wrapper\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br><span class=\"line-number\">12</span><br><span class=\"line-number\">13</span><br><span class=\"line-number\">14</span><br><span class=\"line-number\">15</span><br><span class=\"line-number\">16</span><br><span class=\"line-number\">17</span><br><span class=\"line-number\">18</span><br><span class=\"line-number\">19</span><br><span class=\"line-number\">20</span><br><span class=\"line-number\">21</span><br><span class=\"line-number\">22</span><br><span class=\"line-number\">23</span><br><span class=\"line-number\">24</span><br><span class=\"line-number\">25</span><br><span class=\"line-number\">26</span><br><span class=\"line-number\">27</span><br><span class=\"line-number\">28</span><br><span class=\"line-number\">29</span><br><span class=\"line-number\">30</span><br><span class=\"line-number\">31</span><br><span class=\"line-number\">32</span><br><span class=\"line-number\">33</span><br><span class=\"line-number\">34</span><br><span class=\"line-number\">35</span><br><span class=\"line-number\">36</span><br><span class=\"line-number\">37</span><br><span class=\"line-number\">38</span><br><span class=\"line-number\">39</span><br><span class=\"line-number\">40</span><br><span class=\"line-number\">41</span><br><span class=\"line-number\">42</span><br><span class=\"line-number\">43</span><br><span class=\"line-number\">44</span><br><span class=\"line-number\">45</span><br><span class=\"line-number\">46</span><br></div><!--beforeend--></div><!--afterend--><h4 id=\"html完整代码\"><a class=\"header-anchor\" href=\"#html完整代码\" aria-hidden=\"true\">#</a> html完整代码</h4>\n<p>这里是html的完整代码，代码中有详细注释，建议根据上面的<strong>命令行面板做了哪些事情</strong>，来阅读源码。</p>\n<!--beforebegin--><div class=\"language-html line-numbers-mode\"><!--afterbegin--><pre v-pre class=\"language-html\"><code><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>极简electron终端<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span>\n      <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://unpkg.com/element-ui/lib/theme-chalk/index.css<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://unpkg.com/vue<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- 引入element --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://unpkg.com/element-ui/lib/index.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- css --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>./index.css<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>app<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>main-class<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\">&lt;!-- 渲染过往的命令行 --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>item in commandArr<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>command-action<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            <span class=\"token comment\">&lt;!-- 执行成功或者失败图标切换 --></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span>\n              <span class=\"token attr-name\">:class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>[<span class=\"token punctuation\">'</span>el-icon-right<span class=\"token punctuation\">'</span>, <span class=\"token punctuation\">'</span>command-action-icon<span class=\"token punctuation\">'</span>, { <span class=\"token punctuation\">'</span>error-icon<span class=\"token punctuation\">'</span>: item.code !== 0  }]<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token comment\">&lt;!-- 过往执行地址和命令行、信息 --></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>command-action-path<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{ item.path }} $<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>command-action-contenteditable<span class=\"token punctuation\">\"</span></span>\n              <span class=\"token punctuation\">></span></span>{{ item.command }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span>\n            <span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>output-command<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{ item.commandMsg }}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\">&lt;!-- 当前输入的命令行 --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\n          <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>command-action command-action-editor<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">@mouseup</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>timeoutFocusInput<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>i</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>el-icon-right command-action-icon<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>i</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token comment\">&lt;!-- 执行地址 --></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>command-action-path<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{ path }} $<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token comment\">&lt;!-- 命令行输入 --></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span>\n            <span class=\"token attr-name\">:contenteditable</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>action ? false : <span class=\"token punctuation\">'</span>plaintext-only<span class=\"token punctuation\">'</span><span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>command-action-contenteditable<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">@input</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>onDivInput($event)<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">@keydown</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>keyFn<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token comment\">&lt;!-- 当前命令行输出 --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>output-command<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>item in commandMsg<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>{{item}}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\">\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> ipcRenderer <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'electron'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> spawn <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'child_process'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token keyword\">var</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        el<span class=\"token punctuation\">:</span> <span class=\"token string\">'#app'</span><span class=\"token punctuation\">,</span>\n        data<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          path<span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 命令行目录</span>\n          command<span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 用户输入命令</span>\n          handleCommand<span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 经过处理的用户命令 比如清除首尾空格、添加获取路径的命令</span>\n          commandMsg<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 当前命令信息</span>\n          commandArr<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 过往命令行输出保存</span>\n          isActive<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 终端是否聚焦</span>\n          action<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 是否正在执行命令</span>\n          inputDom<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 输入框dom</span>\n          addPath<span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 不同系统 获取路径的命令 mac是pwd window是chdir</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">mounted</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addGetPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputDom <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span>\n            <span class=\"token string\">'.command-action-contenteditable'</span>\n          <span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>path <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span><span class=\"token function\">cwd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 初始化路径</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">watchFocus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          ipcRenderer<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'page-ready'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 告诉主进程页面准备好了</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        methods<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// 回车执行命令</span>\n          <span class=\"token function\">keyFn</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>keyCode <span class=\"token operator\">==</span> <span class=\"token number\">13</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">actionCommand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n              e<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 执行命令</span>\n          <span class=\"token function\">actionCommand</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> command <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>command<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">isClear</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>command <span class=\"token operator\">===</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>action <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handleCommand <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">cdCommand</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">const</span> ls <span class=\"token operator\">=</span> <span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handleCommand<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n              encoding<span class=\"token punctuation\">:</span> <span class=\"token string\">'utf8'</span><span class=\"token punctuation\">,</span>\n              cwd<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 执行命令路径</span>\n              shell<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 使用shell命令</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token comment\">// 监听命令行执行过程的输出</span>\n            ls<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>commandMsg<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>\n              console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`stdout: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>value<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token comment\">// 错误或详细状态进度报告 比如 git push、 git clone </span>\n            ls<span class=\"token punctuation\">.</span>stderr<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>commandMsg<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`stderr: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n              console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token string\">`stderr: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>data<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token comment\">// 子进程关闭事件 保存信息 更新状态</span>\n            ls<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'close'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>closeCommandAction<span class=\"token punctuation\">)</span> \n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 执行完毕 保存信息 更新状态</span>\n          <span class=\"token function\">closeCommandAction</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 保存执行信息</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>commandArr<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n              code<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 是否执行成功</span>\n              path<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 执行路径</span>\n              command<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>command<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 执行命令</span>\n              commandMsg<span class=\"token punctuation\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>commandMsg<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\r'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 执行信息</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token comment\">// 清空</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">updatePath</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handleCommand<span class=\"token punctuation\">,</span> code<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">commandFinish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>\n              <span class=\"token template-string\"><span class=\"token string\">`子进程退出，退出码 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>code<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, 运行</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>code <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token string\">'成功'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'失败'</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">`</span></span>\n            <span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// cd命令处理</span>\n          <span class=\"token function\">cdCommand</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> pathCommand <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>command<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cd '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              pathCommand <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>addPath\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>command<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">' cd '</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              pathCommand <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>addPath\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> command <span class=\"token operator\">+</span> pathCommand\n            <span class=\"token comment\">// 目录自动联想...等很多细节功能 可以做但没必要2</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 清空历史</span>\n          <span class=\"token function\">isClear</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>command <span class=\"token operator\">===</span> <span class=\"token string\">'clear'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>commandArr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">commandFinish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 获取不同系统下的路径</span>\n          <span class=\"token function\">addGetPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> systemName <span class=\"token operator\">=</span> <span class=\"token function\">getOsInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>systemName <span class=\"token operator\">===</span> <span class=\"token string\">'Mac'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>addPath <span class=\"token operator\">=</span> <span class=\"token string\">' &amp;&amp; pwd'</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>systemName <span class=\"token operator\">===</span> <span class=\"token string\">'Windows'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>addPath <span class=\"token operator\">=</span> <span class=\"token string\">' &amp;&amp; chdir'</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 命令执行完毕 重置参数</span>\n          <span class=\"token function\">commandFinish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>commandMsg <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>command <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputDom<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>action <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>\n            <span class=\"token comment\">// 激活编辑器</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$nextTick</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">focusInput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">scrollBottom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 判断命令是否添加过addPath</span>\n          <span class=\"token function\">updatePath</span><span class=\"token punctuation\">(</span>command<span class=\"token punctuation\">,</span> code<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>code <span class=\"token operator\">!==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n            <span class=\"token keyword\">const</span> isPathChange <span class=\"token operator\">=</span> command<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>addPath<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isPathChange<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>path <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>commandMsg<span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>commandMsg<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 保存输入的命令行</span>\n          <span class=\"token function\">onDivInput</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>command <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>textContent\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 点击div</span>\n          <span class=\"token function\">timeoutFocusInput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">focusInput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 聚焦输入</span>\n          <span class=\"token function\">focusInput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputDom<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//解决ff不获取焦点无法定位问题</span>\n            <span class=\"token keyword\">var</span> range <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">getSelection</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//创建range</span>\n            range<span class=\"token punctuation\">.</span><span class=\"token function\">selectAllChildren</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputDom<span class=\"token punctuation\">)</span> <span class=\"token comment\">//range 选择obj下所有子内容</span>\n            range<span class=\"token punctuation\">.</span><span class=\"token function\">collapseToEnd</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//光标移至最后</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>inputDom<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 滚动到底部</span>\n          <span class=\"token function\">scrollBottom</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> dom <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#app'</span><span class=\"token punctuation\">)</span>\n            dom<span class=\"token punctuation\">.</span>scrollTop <span class=\"token operator\">=</span> dom<span class=\"token punctuation\">.</span>scrollHeight <span class=\"token comment\">// 滚动高度</span>\n            dom <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 监听窗口聚焦、失焦</span>\n          <span class=\"token function\">watchFocus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            ipcRenderer<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'win-focus'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isActive <span class=\"token operator\">=</span> message\n              <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">focusInput</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n      <span class=\"token comment\">// 获取操作系统信息</span>\n      <span class=\"token keyword\">function</span> <span class=\"token function\">getOsInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> userAgent <span class=\"token operator\">=</span> navigator<span class=\"token punctuation\">.</span>userAgent<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">var</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'Unknown'</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>userAgent<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'win'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          name <span class=\"token operator\">=</span> <span class=\"token string\">'Windows'</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>userAgent<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'iphone'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          name <span class=\"token operator\">=</span> <span class=\"token string\">'iPhone'</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>userAgent<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mac'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          name <span class=\"token operator\">=</span> <span class=\"token string\">'Mac'</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n          userAgent<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'x11'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">||</span>\n          userAgent<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'unix'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">||</span>\n          userAgent<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sunname'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">||</span>\n          userAgent<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bsd'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span>\n        <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          name <span class=\"token operator\">=</span> <span class=\"token string\">'Unix'</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>userAgent<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'linux'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>userAgent<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'android'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            name <span class=\"token operator\">=</span> <span class=\"token string\">'Android'</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            name <span class=\"token operator\">=</span> <span class=\"token string\">'Linux'</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> name\n      <span class=\"token punctuation\">}</span>\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span>\n</code></pre>\n<div class=\"line-numbers-wrapper\"><span class=\"line-number\">1</span><br><span class=\"line-number\">2</span><br><span class=\"line-number\">3</span><br><span class=\"line-number\">4</span><br><span class=\"line-number\">5</span><br><span class=\"line-number\">6</span><br><span class=\"line-number\">7</span><br><span class=\"line-number\">8</span><br><span class=\"line-number\">9</span><br><span class=\"line-number\">10</span><br><span class=\"line-number\">11</span><br><span class=\"line-number\">12</span><br><span class=\"line-number\">13</span><br><span class=\"line-number\">14</span><br><span class=\"line-number\">15</span><br><span class=\"line-number\">16</span><br><span class=\"line-number\">17</span><br><span class=\"line-number\">18</span><br><span class=\"line-number\">19</span><br><span class=\"line-number\">20</span><br><span class=\"line-number\">21</span><br><span class=\"line-number\">22</span><br><span class=\"line-number\">23</span><br><span class=\"line-number\">24</span><br><span class=\"line-number\">25</span><br><span class=\"line-number\">26</span><br><span class=\"line-number\">27</span><br><span class=\"line-number\">28</span><br><span class=\"line-number\">29</span><br><span class=\"line-number\">30</span><br><span class=\"line-number\">31</span><br><span class=\"line-number\">32</span><br><span class=\"line-number\">33</span><br><span class=\"line-number\">34</span><br><span class=\"line-number\">35</span><br><span class=\"line-number\">36</span><br><span class=\"line-number\">37</span><br><span class=\"line-number\">38</span><br><span class=\"line-number\">39</span><br><span class=\"line-number\">40</span><br><span class=\"line-number\">41</span><br><span class=\"line-number\">42</span><br><span class=\"line-number\">43</span><br><span class=\"line-number\">44</span><br><span class=\"line-number\">45</span><br><span class=\"line-number\">46</span><br><span class=\"line-number\">47</span><br><span class=\"line-number\">48</span><br><span class=\"line-number\">49</span><br><span class=\"line-number\">50</span><br><span class=\"line-number\">51</span><br><span class=\"line-number\">52</span><br><span class=\"line-number\">53</span><br><span class=\"line-number\">54</span><br><span class=\"line-number\">55</span><br><span class=\"line-number\">56</span><br><span class=\"line-number\">57</span><br><span class=\"line-number\">58</span><br><span class=\"line-number\">59</span><br><span class=\"line-number\">60</span><br><span class=\"line-number\">61</span><br><span class=\"line-number\">62</span><br><span class=\"line-number\">63</span><br><span class=\"line-number\">64</span><br><span class=\"line-number\">65</span><br><span class=\"line-number\">66</span><br><span class=\"line-number\">67</span><br><span class=\"line-number\">68</span><br><span class=\"line-number\">69</span><br><span class=\"line-number\">70</span><br><span class=\"line-number\">71</span><br><span class=\"line-number\">72</span><br><span class=\"line-number\">73</span><br><span class=\"line-number\">74</span><br><span class=\"line-number\">75</span><br><span class=\"line-number\">76</span><br><span class=\"line-number\">77</span><br><span class=\"line-number\">78</span><br><span class=\"line-number\">79</span><br><span class=\"line-number\">80</span><br><span class=\"line-number\">81</span><br><span class=\"line-number\">82</span><br><span class=\"line-number\">83</span><br><span class=\"line-number\">84</span><br><span class=\"line-number\">85</span><br><span class=\"line-number\">86</span><br><span class=\"line-number\">87</span><br><span class=\"line-number\">88</span><br><span class=\"line-number\">89</span><br><span class=\"line-number\">90</span><br><span class=\"line-number\">91</span><br><span class=\"line-number\">92</span><br><span class=\"line-number\">93</span><br><span class=\"line-number\">94</span><br><span class=\"line-number\">95</span><br><span class=\"line-number\">96</span><br><span class=\"line-number\">97</span><br><span class=\"line-number\">98</span><br><span class=\"line-number\">99</span><br><span class=\"line-number\">100</span><br><span class=\"line-number\">101</span><br><span class=\"line-number\">102</span><br><span class=\"line-number\">103</span><br><span class=\"line-number\">104</span><br><span class=\"line-number\">105</span><br><span class=\"line-number\">106</span><br><span class=\"line-number\">107</span><br><span class=\"line-number\">108</span><br><span class=\"line-number\">109</span><br><span class=\"line-number\">110</span><br><span class=\"line-number\">111</span><br><span class=\"line-number\">112</span><br><span class=\"line-number\">113</span><br><span class=\"line-number\">114</span><br><span class=\"line-number\">115</span><br><span class=\"line-number\">116</span><br><span class=\"line-number\">117</span><br><span class=\"line-number\">118</span><br><span class=\"line-number\">119</span><br><span class=\"line-number\">120</span><br><span class=\"line-number\">121</span><br><span class=\"line-number\">122</span><br><span class=\"line-number\">123</span><br><span class=\"line-number\">124</span><br><span class=\"line-number\">125</span><br><span class=\"line-number\">126</span><br><span class=\"line-number\">127</span><br><span class=\"line-number\">128</span><br><span class=\"line-number\">129</span><br><span class=\"line-number\">130</span><br><span class=\"line-number\">131</span><br><span class=\"line-number\">132</span><br><span class=\"line-number\">133</span><br><span class=\"line-number\">134</span><br><span class=\"line-number\">135</span><br><span class=\"line-number\">136</span><br><span class=\"line-number\">137</span><br><span class=\"line-number\">138</span><br><span class=\"line-number\">139</span><br><span class=\"line-number\">140</span><br><span class=\"line-number\">141</span><br><span class=\"line-number\">142</span><br><span class=\"line-number\">143</span><br><span class=\"line-number\">144</span><br><span class=\"line-number\">145</span><br><span class=\"line-number\">146</span><br><span class=\"line-number\">147</span><br><span class=\"line-number\">148</span><br><span class=\"line-number\">149</span><br><span class=\"line-number\">150</span><br><span class=\"line-number\">151</span><br><span class=\"line-number\">152</span><br><span class=\"line-number\">153</span><br><span class=\"line-number\">154</span><br><span class=\"line-number\">155</span><br><span class=\"line-number\">156</span><br><span class=\"line-number\">157</span><br><span class=\"line-number\">158</span><br><span class=\"line-number\">159</span><br><span class=\"line-number\">160</span><br><span class=\"line-number\">161</span><br><span class=\"line-number\">162</span><br><span class=\"line-number\">163</span><br><span class=\"line-number\">164</span><br><span class=\"line-number\">165</span><br><span class=\"line-number\">166</span><br><span class=\"line-number\">167</span><br><span class=\"line-number\">168</span><br><span class=\"line-number\">169</span><br><span class=\"line-number\">170</span><br><span class=\"line-number\">171</span><br><span class=\"line-number\">172</span><br><span class=\"line-number\">173</span><br><span class=\"line-number\">174</span><br><span class=\"line-number\">175</span><br><span class=\"line-number\">176</span><br><span class=\"line-number\">177</span><br><span class=\"line-number\">178</span><br><span class=\"line-number\">179</span><br><span class=\"line-number\">180</span><br><span class=\"line-number\">181</span><br><span class=\"line-number\">182</span><br><span class=\"line-number\">183</span><br><span class=\"line-number\">184</span><br><span class=\"line-number\">185</span><br><span class=\"line-number\">186</span><br><span class=\"line-number\">187</span><br><span class=\"line-number\">188</span><br><span class=\"line-number\">189</span><br><span class=\"line-number\">190</span><br><span class=\"line-number\">191</span><br><span class=\"line-number\">192</span><br><span class=\"line-number\">193</span><br><span class=\"line-number\">194</span><br><span class=\"line-number\">195</span><br><span class=\"line-number\">196</span><br><span class=\"line-number\">197</span><br><span class=\"line-number\">198</span><br><span class=\"line-number\">199</span><br><span class=\"line-number\">200</span><br><span class=\"line-number\">201</span><br><span class=\"line-number\">202</span><br><span class=\"line-number\">203</span><br><span class=\"line-number\">204</span><br><span class=\"line-number\">205</span><br><span class=\"line-number\">206</span><br><span class=\"line-number\">207</span><br><span class=\"line-number\">208</span><br><span class=\"line-number\">209</span><br><span class=\"line-number\">210</span><br><span class=\"line-number\">211</span><br><span class=\"line-number\">212</span><br><span class=\"line-number\">213</span><br><span class=\"line-number\">214</span><br><span class=\"line-number\">215</span><br><span class=\"line-number\">216</span><br><span class=\"line-number\">217</span><br><span class=\"line-number\">218</span><br><span class=\"line-number\">219</span><br><span class=\"line-number\">220</span><br><span class=\"line-number\">221</span><br><span class=\"line-number\">222</span><br><span class=\"line-number\">223</span><br><span class=\"line-number\">224</span><br><span class=\"line-number\">225</span><br><span class=\"line-number\">226</span><br><span class=\"line-number\">227</span><br><span class=\"line-number\">228</span><br><span class=\"line-number\">229</span><br><span class=\"line-number\">230</span><br><span class=\"line-number\">231</span><br><span class=\"line-number\">232</span><br><span class=\"line-number\">233</span><br><span class=\"line-number\">234</span><br><span class=\"line-number\">235</span><br><span class=\"line-number\">236</span><br><span class=\"line-number\">237</span><br><span class=\"line-number\">238</span><br><span class=\"line-number\">239</span><br><span class=\"line-number\">240</span><br><span class=\"line-number\">241</span><br><span class=\"line-number\">242</span><br><span class=\"line-number\">243</span><br><span class=\"line-number\">244</span><br><span class=\"line-number\">245</span><br><span class=\"line-number\">246</span><br><span class=\"line-number\">247</span><br></div><!--beforeend--></div><!--afterend--><p>以上就是整个项目的代码实现，总共只有三个文件。</p>\n<p><strong>更多细节</strong></p>\n<p>本项目终究是一个简单的demo，如果想要做成一个完整的开源项目，还需要补充很多细节。</p>\n<p>还会有各种各样奇奇怪怪的需求和需要定制的地方，比如下面这些：</p>\n<ul>\n<li><code>command+c</code>终止命令</li>\n<li><code>cd</code>目录自动补全</li>\n<li>命令保存上下键滑动</li>\n<li>git等常用功能单独特殊处理。</li>\n<li>输出信息颜色变化</li>\n<li>等等</li>\n</ul>\n<h2 id=\"下载试玩\"><a class=\"header-anchor\" href=\"#下载试玩\" aria-hidden=\"true\">#</a> 下载试玩</h2>\n<p>即使这个终端demo的代码量很少，注释足够详细，但还是需要上手体验一下一个Electron项目运行的细节。</p>\n<h3 id=\"项目演示\"><a class=\"header-anchor\" href=\"#项目演示\" aria-hidden=\"true\">#</a> 项目演示</h3>\n<p><strong>clear命令演示</strong></p>\n<p>实际上就是将历史命令行输出的数组重置为空数组。</p>\n<p><img src=\"https://raw.githubusercontent.com/OBKoro1/articleImg_src/master/2021/electron-terminal/electron-terminal-clear.gif\" alt=\"\"></p>\n<p><strong>执行失败箭头切换</strong></p>\n<p>根据子进程<code>close</code>事件，判断执行是否成功，切换一下图标。</p>\n<p><img src=\"https://raw.githubusercontent.com/OBKoro1/articleImg_src/master/2021/electron-terminal/electron-terminal-error.gif\" alt=\"\"></p>\n<p><strong>cd命令</strong></p>\n<p>识别<code>cd</code>命令，根据系统添加获取路径(<code>pwd</code>/<code>chdir</code>)的命令，再将获取到的路径，更改为最终路径。</p>\n<p><img src=\"https://raw.githubusercontent.com/OBKoro1/articleImg_src/master/2021/electron-terminal/electron-terminal-cd.gif\" alt=\"\"></p>\n<p><strong>giit提交代码演示</strong></p>\n<p><img src=\"https://raw.githubusercontent.com/OBKoro1/articleImg_src/master/2021/electron-terminal/electron-terminal-git.gif\" alt=\"\"></p>\n<h3 id=\"项目地址\"><a class=\"header-anchor\" href=\"#项目地址\" aria-hidden=\"true\">#</a> 项目地址</h3>\n<p>开源地址: <a href=\"https://github.com/OBKoro1/electron-terminal-demo\" target=\"_blank\" rel=\"noopener noreferrer\">electron-terminal-demo<OutboundLink/></a></p>\n<h3 id=\"启动与调试\"><a class=\"header-anchor\" href=\"#启动与调试\" aria-hidden=\"true\">#</a> 启动与调试</h3>\n<p><strong>安装</strong></p>\n<!--beforebegin--><div class=\"language- line-numbers-mode\"><!--afterbegin--><pre v-pre class=\"language-text\"><code>npm install\n</code></pre>\n<div class=\"line-numbers-wrapper\"><span class=\"line-number\">1</span><br></div><!--beforeend--></div><!--afterend--><p><strong>启动</strong></p>\n<ol>\n<li>\n<p>通过vscode的调试运行项目，这种形式可以直接在VSCode中进行debugger调试。</p>\n<p><img src=\"https://raw.githubusercontent.com/OBKoro1/articleImg_src/master/2021/electron-terminal/electron-terminal-vscode-config.jpg\" alt=\"\"></p>\n</li>\n<li>\n<p>如果不是使用vscode编辑器, 也可以通过使用命令行启动。</p>\n</li>\n</ol>\n<!--beforebegin--><div class=\"language-js line-numbers-mode\"><!--afterbegin--><pre v-pre class=\"language-js\"><code>npm run start\n</code></pre>\n<div class=\"line-numbers-wrapper\"><span class=\"line-number\">1</span><br></div><!--beforeend--></div><!--afterend--><h2 id=\"小结\"><a class=\"header-anchor\" href=\"#小结\" aria-hidden=\"true\">#</a> 小结</h2>\n<p>命令行终端的实现原理就是这样啦，强烈推荐各位下载体验一下这个项目，最好单步调试一下，这样会更熟悉<code>Electron</code>。</p>\n<p>文章idea诞生于我们团队开源的另一个开源项目：<a href=\"https://github.com/tal-tech/electron-playground\" target=\"_blank\" rel=\"noopener noreferrer\">electron-playground<OutboundLink/></a>, 目的是为了让小伙伴学习<code>electron</code>实战项目。</p>\n<p>electron-playground是用来帮助前端小伙伴们更好、更快的学习和理解前端桌面端技术Electron, 尽量少走弯路。</p>\n<p>它通过如下方式让我们快速学习electron。</p>\n<ol>\n<li>带有gif示例和可操作的demo的教程文章。</li>\n<li>系统性的整理了Electron相关的api和功能。</li>\n<li>搭配演练场，自己动手尝试electron的各种特性。</li>\n</ol>\n<p><a href=\"http://obkoro1.com/web_accumulate/\" target=\"_blank\" rel=\"noopener noreferrer\">前端进阶积累<OutboundLink/></a>、<a href=\"https://user-gold-cdn.xitu.io/2018/5/1/1631b6f52f7e7015?w=344&amp;h=344&amp;f=jpeg&amp;s=8317\" target=\"_blank\" rel=\"noopener noreferrer\">公众号<OutboundLink/></a>、<a href=\"https://github.com/OBKoro1\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub<OutboundLink/></a>、wx:OBkoro1、邮箱：obkoro1@foxmail.com</p>\n<p>以上2021/01/12\n<!-- 特殊字符串：用于修改/删除markdown的结尾提示语-OBKoro1 --></p>\n<h3 id=\"点个star支持我一下\"><a class=\"header-anchor\" href=\"#点个star支持我一下\" aria-hidden=\"true\">#</a> 点个<a href=\"https://github.com/OBKoro1/web_accumulate\" target=\"_blank\" rel=\"noopener noreferrer\">Star<OutboundLink/></a>支持我一下~</h3>\n<!-- '特殊字符串：用于删除编译后的issue组件-OBKoro1 -->\n<!-- more -->\n<comment-comment/>\n</div>\n",null]}