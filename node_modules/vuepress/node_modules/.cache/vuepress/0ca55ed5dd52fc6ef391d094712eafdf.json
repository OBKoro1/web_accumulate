{"remainingRequest":"/Users/koro/work/web_my/web_accumulate/node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!/Users/koro/work/web_my/web_accumulate/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/koro/work/web_my/web_accumulate/node_modules/vue-loader/lib/index.js??ref--1-1!/Users/koro/work/web_my/web_accumulate/node_modules/vuepress/lib/webpack/markdownLoader.js??ref--1-2!/Users/koro/work/web_my/web_accumulate/docs/accumulate/effect/退出页面发送请求.md?vue&type=template&id=53ce5012&","dependencies":[{"path":"/Users/koro/work/web_my/web_accumulate/docs/accumulate/effect/退出页面发送请求.md","mtime":1610439313671},{"path":"/Users/koro/work/web_my/web_accumulate/node_modules/cache-loader/dist/cjs.js","mtime":1557296864520},{"path":"/Users/koro/work/web_my/web_accumulate/node_modules/vue-loader/lib/loaders/templateLoader.js","mtime":1557296867191},{"path":"/Users/koro/work/web_my/web_accumulate/node_modules/cache-loader/dist/cjs.js","mtime":1557296864520},{"path":"/Users/koro/work/web_my/web_accumulate/node_modules/vue-loader/lib/index.js","mtime":1557296867190},{"path":"/Users/koro/work/web_my/web_accumulate/node_modules/vuepress/lib/webpack/markdownLoader.js","mtime":1557296867284}],"contextDependencies":[],"result":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"content\"},[_vm._m(0),_vm._v(\" \"),_vm._m(1),_vm._v(\" \"),_vm._m(2),_vm._v(\" \"),_c('p',[_vm._v(\"一开始以为这个需求非常简单，就是在进入其他路由前，发送一下请求，杀死一下任务就好了。\")]),_vm._v(\" \"),_c('p',[_vm._v(\"然而现实狠狠的打了我的脸，因为退出页面的场景不止切换路由~\")]),_vm._v(\" \"),_vm._m(3),_vm._v(\" \"),_vm._m(4),_vm._v(\" \"),_vm._m(5),_vm._v(\" \"),_vm._m(6),_vm._v(\" \"),_vm._m(7),_vm._m(8),_vm._v(\" \"),_vm._m(9),_vm._v(\" \"),_vm._m(10),_vm._v(\" \"),_vm._m(11),_vm._v(\" \"),_vm._m(12),_vm._v(\" \"),_vm._m(13),_vm._v(\" \"),_c('p',[_vm._v(\"在 chrome 下长这个样子，你们肯定都见过：\")]),_vm._v(\" \"),_vm._m(14),_vm._v(\" \"),_vm._m(15),_vm._v(\" \"),_vm._m(16),_vm._v(\" \"),_vm._m(17),_vm._m(18),_vm._v(\" \"),_c('p',[_vm._v(\"以下行为是基于 chorme：\")]),_vm._v(\" \"),_vm._m(19),_vm._v(\" \"),_vm._m(20),_vm._v(\" \"),_vm._m(21),_vm._v(\" \"),_vm._m(22),_vm._v(\" \"),_c('p',[_vm._v(\"现在大部分浏览器都不允许修改弹窗的标题，这个是为了安全考虑，来保证用户不受到错误信息的误导，\")]),_vm._v(\" \"),_vm._m(23),_vm._v(\" \"),_c('p',[_vm._v(\"一开始我以为既然可以拦截到用户的刷新/关闭页面的操作，出现了上面那个弹窗，这个需求就已经做完了的时候。\")]),_vm._v(\" \"),_vm._m(24),_vm._v(\" \"),_vm._m(25),_vm._v(\" \"),_vm._m(26),_vm._v(\" \"),_vm._m(27),_vm._v(\" \"),_vm._m(28),_vm._v(\" \"),_c('p',[_vm._v(\"当页面正在被卸载的时候触发该事件，该事件不可取消，为不可逆操作。\")]),_vm._v(\" \"),_vm._m(29),_vm._v(\" \"),_c('p',[_vm._v(\"直接监听该事件就可以了。\")]),_vm._v(\" \"),_vm._m(30),_vm._m(31),_vm._v(\" \"),_vm._m(32),_vm._v(\" \"),_vm._m(33),_c('p',[_vm._v(\"到这里大家肯定以为已经做出来了该需求，事实上，并没有！\")]),_vm._v(\" \"),_vm._m(34),_vm._v(\" \"),_vm._m(35),_vm._v(\" \"),_vm._m(36),_vm._v(\" \"),_vm._m(37),_vm._v(\" \"),_c('p',[_c('strong',[_vm._v(\"最后使用原生的\"),_c('a',{attrs:{\"href\":\"http://www.w3school.com.cn/xml/xml_http.asp\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"XMLHttpRequest\"),_c('OutboundLink')],1),_vm._v(\"对象\")]),_vm._v(\"，让请求同步\")]),_vm._v(\" \"),_vm._m(38),_vm._v(\" \"),_vm._m(39),_vm._v(\" \"),_c('p',[_vm._v(\"当我把这篇文章发布在公众号上，被\"),_c('a',{attrs:{\"href\":\"https://mp.weixin.qq.com/s/3taWHBu0vxRXP7WDax5M-Q\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"奇舞周刊\"),_c('OutboundLink')],1),_vm._v(\"转载了，上面一些大佬给我提了一些建议。\")]),_vm._v(\" \"),_c('p',[_vm._v(\"研究了一下，结果...好吧！我承认我是菜鸡。\")]),_vm._v(\" \"),_c('p',[_vm._v(\"hey~ 不过这正是我写博客的收获之一，分享经验，收获知识！\")]),_vm._v(\" \"),_vm._m(40),_vm._v(\" \"),_vm._m(41),_vm._v(\" \"),_vm._m(42),_vm._v(\" \"),_vm._m(43),_vm._v(\" \"),_vm._m(44),_vm._v(\" \"),_vm._m(45),_vm._v(\" \"),_vm._m(46),_vm._v(\" \"),_vm._m(47),_vm._v(\" \"),_vm._m(48),_vm._v(\" \"),_vm._m(49),_vm._v(\" \"),_vm._m(50),_vm._v(\" \"),_vm._m(51),_vm._m(52),_vm._v(\" \"),_vm._m(53),_vm._v(\" \"),_vm._m(54),_vm._v(\" \"),_vm._m(55),_vm._v(\" \"),_vm._m(56),_vm._v(\" \"),_vm._m(57),_vm._v(\" \"),_vm._m(58),_vm._m(59),_vm._v(\" \"),_c('p',[_vm._v(\"浏览器支持：Edge：14+，Firefox：31+，Chrome：39+，Opera：26+，IE：不支持。\")]),_vm._v(\" \"),_vm._m(60),_vm._v(\" \"),_vm._m(61),_vm._m(62),_vm._v(\" \"),_vm._m(63),_vm._v(\" \"),_c('p',[_vm._v(\"这儿有一个MDN提供的\"),_c('a',{attrs:{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/Beacon_API/Using_the_Beacon_API#WorkerNavigator.sendBeacon()\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"栗子\"),_c('OutboundLink')],1),_vm._v(\"，可以点进去看一下。\")]),_vm._v(\" \"),_c('p',[_vm._v(\"PS：对web worker不熟悉的同学可以看我这篇\"),_c('a',{attrs:{\"href\":\"https://juejin.im/post/5bf8fa045188252f170e0dcb\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"文章\"),_c('OutboundLink')],1)]),_vm._v(\" \"),_vm._m(64),_vm._v(\" \"),_vm._m(65),_vm._v(\" \"),_vm._m(66),_vm._v(\" \"),_vm._m(67),_vm._v(\" \"),_c('p',[_vm._v(\"以上2019.02.19\")]),_vm._v(\" \"),_c('p',[_c('a',{attrs:{\"href\":\"http://obkoro1.com/\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"博客\"),_c('OutboundLink')],1),_vm._v(\"、\"),_c('a',{attrs:{\"href\":\"http://obkoro1.com/web_accumulate/accumulate/\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"前端积累文档\"),_c('OutboundLink')],1),_vm._v(\"、\"),_c('a',{attrs:{\"href\":\"https://github.com/OBKoro1/articleImg_src/blob/master/juejin/1631b6f52f7e7015.jpeg?raw=true\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"公众号\"),_c('OutboundLink')],1),_vm._v(\"、\"),_c('a',{attrs:{\"href\":\"https://github.com/OBKoro1\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"GitHub\"),_c('OutboundLink')],1)]),_vm._v(\" \"),_c('p',[_vm._v(\"参考资料：\")]),_vm._v(\" \"),_c('p',[_c('a',{attrs:{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/Beacon_API/Using_the_Beacon_API\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"MDN\"),_c('OutboundLink')],1)]),_vm._v(\" \"),_c('p',[_c('a',{attrs:{\"href\":\"https://www.barretlee.com/blog/2016/02/20/navigator-beacon-api/\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"页面跳转时，统计数据丢失问题探讨\"),_c('OutboundLink')],1)]),_vm._v(\" \"),_c('p',[_c('a',{attrs:{\"href\":\"https://juejin.im/post/5b694b5de51d4519700fa56a#heading-4\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"使用 Web Beacon API 记录活动\"),_c('OutboundLink')],1)]),_vm._v(\" \"),_c('h3',{attrs:{\"id\":\"点个star支持我一下\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#点个star支持我一下\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" 点个\"),_c('a',{attrs:{\"href\":\"https://github.com/OBKoro1/web_accumulate\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\"}},[_vm._v(\"Star\"),_c('OutboundLink')],1),_vm._v(\"支持我一下~\")]),_vm._v(\" \"),_c('comment-comment')],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h2',{attrs:{\"id\":\"web-sendbeacon-刷新-关闭页面之前发送请求\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#web-sendbeacon-刷新-关闭页面之前发送请求\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" Web sendBeacon 刷新/关闭页面之前发送请求\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h3',{attrs:{\"id\":\"背景：\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#背景：\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" 背景：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"有一个任务非常耗时会消耗后台大量算力，所以在退出页面的时候，要求前端这边发送一个请求来杀死任务\")]),_vm._v(\"。\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h3',{attrs:{\"id\":\"退出页面场景：\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#退出页面场景：\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" 退出页面场景：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ol',[_c('li',[_vm._v(\"还在本网站，跳到其他路由\")]),_vm._v(\" \"),_c('li',[_c('strong',[_vm._v(\"刷新页面/关闭页面\")]),_vm._v(\"也需要发送请求来杀死任务\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h3',{attrs:{\"id\":\"还在本网站，跳到其他路由\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#还在本网站，跳到其他路由\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" 还在本网站，跳到其他路由\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"这个比较简单，在\"),_c('code',[_vm._v(\"Vue\")]),_vm._v(\"中可以通过路由离开的钩子\"),_c('code',[_vm._v(\"beforeRouteLeave\")]),_vm._v(\"来实现：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"language-js line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-js\"}},[_c('code',[_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token function\"}},[_vm._v(\"beforeRouteLeave\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_vm._v(\"to\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\",\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"from\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\",\")]),_vm._v(\" next\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n    \"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"if\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_vm._v(\"任务运行中\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n        \"),_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// 发送请求\")]),_vm._v(\"\\n    \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"else\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n        \"),_c('span',{pre:true,attrs:{\"class\":\"token function\"}},[_vm._v(\"next\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_c('span',{pre:true,attrs:{\"class\":\"token boolean\"}},[_vm._v(\"true\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// 用户离开\")]),_vm._v(\"\\n    \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\"\\n \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\"\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br')])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"刷新页面/关闭页面的情况：\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"然而在刷新页面的时候，\"),_c('code',[_vm._v(\"beforeRouteLeave\")]),_vm._v(\"并不会执行，接着想到了下面这两个\"),_c('code',[_vm._v(\"API\")]),_vm._v(\".\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h2',{attrs:{\"id\":\"beforeunload和unload\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#beforeunload和unload\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" \"),_c('code',[_vm._v(\"beforeunload\")]),_vm._v(\"和\"),_c('code',[_vm._v(\"unload\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h3',{attrs:{\"id\":\"beforeunload-当浏览器窗口关闭或者刷新时触发\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#beforeunload-当浏览器窗口关闭或者刷新时触发\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" beforeunload 当浏览器窗口关闭或者刷新时触发:\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"介绍\")]),_vm._v(\"：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"使用这个\"),_c('code',[_vm._v(\"API\")]),_vm._v(\"可以阻止页面直接关闭，用户通过点击确定/取消按钮，来决定是否不关闭/刷新当前页面。\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('img',{attrs:{\"src\":\"https://github.com/OBKoro1/articleImg_src/blob/master/weibo_img_move/005Y4rCogy1g0bvkiozjwj30bt04vglt.jpg?raw=true\",\"alt\":\"\"}})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"如何使用\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"这个 API 的使用非常简单，只要在页面加载的时候监听一下此事件，在需要出现弹窗的时候\"),_c('strong',[_vm._v(\"return 一个可以转化为 true 的值\")]),_vm._v(\",就可以了。\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"language-js line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-js\"}},[_c('code',[_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// 页面卸载之前\")]),_vm._v(\"\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"let\")]),_vm._v(\" killTask \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"=\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token boolean\"}},[_vm._v(\"false\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\";\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// 是否杀死任务\")]),_vm._v(\"\\nwindow\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\".\")]),_c('span',{pre:true,attrs:{\"class\":\"token function-variable function\"}},[_vm._v(\"onbeforeunload\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"=\")]),_vm._v(\" e \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"=>\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n  \"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"if\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_vm._v(\"任务运行 \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"&&\")]),_vm._v(\" 对应页面\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n    killTask \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"=\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token boolean\"}},[_vm._v(\"true\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\";\")]),_vm._v(\"\\n    \"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"return\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token string\"}},[_vm._v(\"'您可能有数据没有保存'\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\";\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// 在部分浏览器可以修改弹窗标题\")]),_vm._v(\"\\n  \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"else\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n    killTask \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"=\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token boolean\"}},[_vm._v(\"false\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\";\")]),_vm._v(\"\\n  \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\"\\n  \"),_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// 没有return一个可以转化为true的值 就不会出现弹窗\")]),_vm._v(\"\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\";\")]),_vm._v(\"\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"8\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"9\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"10\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"11\")]),_c('br')])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"出现此弹窗的浏览器行为\")]),_vm._v(\"：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ol',[_c('li',[_c('p',[_vm._v(\"焦点：你没有点击取消/确定之前，焦点会一直在此弹窗上\")])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"你无法在出现弹窗的页面上执行任何操作\")])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"在其他页面也只能执行简单的点击操作，弹窗还是存在页面中间，无法使用键盘，\")])]),_vm._v(\" \"),_c('li',[_c('p',[_vm._v(\"键盘：键盘被绑定在弹窗上，只能通过按键\"),_c('code',[_vm._v(\"Esc\")]),_vm._v(\"、\"),_c('code',[_vm._v(\"Enter\")]),_vm._v(\"来执行取消/确定操作\")])]),_vm._v(\" \"),_c('li',[_c('p',[_c('strong',[_vm._v(\"弹窗不是页面的 dom，是浏览器的行为\")])])]),_vm._v(\" \"),_c('li',[_c('p',[_c('strong',[_vm._v(\"用户取消/确定，没有回调 API，无法得知\")])])])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"弹窗标题\")]),_vm._v(\"：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"chrome 中刷新页面的标题：\"),_c('code',[_vm._v(\"重新加载此网站?\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"chrome 中关闭页面的标题：\"),_c('code',[_vm._v(\"离开此网站?\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"迷茫\")]),_vm._v(\"：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"然后发现，\"),_c('strong',[_vm._v(\"浏览器竟然没有提供用户点击确定/取消刷新页面的回调\")]),_vm._v(\"。\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"到这里我陷入了迷茫，盯着\"),_c('code',[_vm._v(\"beforeunload\")]),_vm._v(\"这个 API 思考了起了人生的意义(其实是在发呆)，盯着盯着，从\"),_c('code',[_vm._v(\"beforeunload\")]),_vm._v(\"的\"),_c('code',[_vm._v(\"before\")]),_vm._v(\"我也就想到了\"),_c('code',[_vm._v(\"unload\")]),_vm._v(\"这个 API。\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"瞬间又燃起了斗志，何不试试这个\"),_c('code',[_vm._v(\"unload\")]),_vm._v(\"？\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h3',{attrs:{\"id\":\"unload当页面正在被卸载的时候触发该事件\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#unload当页面正在被卸载的时候触发该事件\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" \"),_c('code',[_vm._v(\"unload\")]),_vm._v(\"当页面正在被卸载的时候触发该事件\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"介绍\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"使用\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"language-js line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-js\"}},[_c('code',[_vm._v(\"window\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\".\")]),_c('span',{pre:true,attrs:{\"class\":\"token function-variable function\"}},[_vm._v(\"onunload\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"=\")]),_vm._v(\" e \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"=>\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\"\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br')])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"结合需求\")]),_vm._v(\":\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('code',[_vm._v(\"killTask\")]),_vm._v(\"为\"),_c('code',[_vm._v(\"beforeunload\")]),_vm._v(\"时定义的变量，每次进入回调，都会给\"),_c('code',[_vm._v(\"killTask\")]),_vm._v(\"赋值，使用这个值就可以判断什么时候可以发送请求杀死任务。\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"language-js line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-js\"}},[_c('code',[_vm._v(\"window\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\".\")]),_c('span',{pre:true,attrs:{\"class\":\"token function-variable function\"}},[_vm._v(\"onunload\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"=\")]),_vm._v(\" e \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"=>\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n  \"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"if\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_vm._v(\"killTask \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"&&\")]),_vm._v(\" 对应页面\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n    \"),_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// 发送请求\")]),_vm._v(\"\\n  \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\"\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\";\")]),_vm._v(\"\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br')])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"无法发送异步请求\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"我使用的是\"),_c('code',[_vm._v(\"axios\")]),_vm._v(\"来发送请求，请求发出去了，但是被取消了，服务器那边根本没有收到请求，如下。\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('img',{attrs:{\"src\":\"https://github.com/OBKoro1/articleImg_src/blob/master/weibo_img_move/005Y4rCogy1g0bvl43w8gj31gd06n761.jpg?raw=true\",\"alt\":\"\"}})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"经过一顿分析:发现是\"),_c('code',[_vm._v(\"axios\")]),_vm._v(\"请求是异步的问题，谷歌之后发现axios不支持同步的请求\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('s',[_vm._v(\"大功告成！\")]),_vm._v(\" 实际上，上面才是我第一次要发的内容，而下面更好的解决方法！\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h2',{attrs:{\"id\":\"缺陷与更好的建议：\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#缺陷与更好的建议：\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" 缺陷与更好的建议：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h3',{attrs:{\"id\":\"性能缺陷：\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#性能缺陷：\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" 性能缺陷：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"XHR同步请求会阻碍页面卸载，如果是刷新/跳转页面的话，\"),_c('strong',[_vm._v(\"页面重新展示速度会变慢，导致性能问题\")]),_vm._v(\"。\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"毕竟\"),_c('strong',[_vm._v(\"向网络发送请求并获得响应可能会超级慢\")]),_vm._v(\"，有可能是用户网络环境比较差，又或者是服务器挂了，请求一直没返回回来...\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"基于性能问题，大佬们推荐\"),_c('strong',[_vm._v(\"使用Beacon代替XHR\")]),_vm._v(\"，然后经过一番搜索...\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h3',{attrs:{\"id\":\"beacon-api\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#beacon-api\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" Beacon API\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ol',[_c('li',[_c('strong',[_vm._v(\"Beacon API用于将少量数据通过post请求发送到服务器\")]),_vm._v(\"。\")]),_vm._v(\" \"),_c('li',[_c('strong',[_c('code',[_vm._v(\"Beacon\")]),_vm._v(\"是非阻塞请求，不需要响应\")])])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h4',{attrs:{\"id\":\"完美解决性能缺陷问题：\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#完美解决性能缺陷问题：\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" 完美解决性能缺陷问题：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ol',[_c('li',[_c('strong',[_vm._v(\"浏览器将 \"),_c('code',[_vm._v(\"Beacon\")]),_vm._v(\" 请求排队让它在空闲的时候执行并立即返回控制\")])]),_vm._v(\" \"),_c('li',[_vm._v(\"它在\"),_c('code',[_vm._v(\"unload\")]),_vm._v(\"状态下也可以异步发送，不阻塞页面刷新/跳转等操作。\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"所以**\"),_c('code',[_vm._v(\"Beacon\")]),_vm._v(\"可以完美解决上面提到的因XHR同步请求阻塞而引起的性能缺陷问题**。\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h4',{attrs:{\"id\":\"使用：navigator-sendbeacon\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#使用：navigator-sendbeacon\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" 使用：\"),_c('code',[_vm._v(\"navigator.sendBeacon()\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('strong',[_vm._v(\"完整API\")]),_vm._v(\"：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"language-js line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-js\"}},[_c('code',[_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"let\")]),_vm._v(\" result \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"=\")]),_vm._v(\" navigator\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\".\")]),_c('span',{pre:true,attrs:{\"class\":\"token function\"}},[_vm._v(\"sendBeacon\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_vm._v(\"url\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\",\")]),_vm._v(\" data\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\";\")]),_vm._v(\"\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br')])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('code',[_vm._v(\"Beacon\")]),_vm._v(\"是挂在\"),_c('code',[_vm._v(\"navigator\")]),_vm._v(\"下面的，上面就是它的完整API。\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('code',[_vm._v(\"result\")]),_vm._v(\"是一个布尔值，代表这次发送请求的结果:\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ul',[_c('li',[_vm._v(\"如果浏览器接受并且把请求排队了则返回 tru\")]),_vm._v(\" \"),_c('li',[_vm._v(\"如果在这个过程中出现了问题就返回 false\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('code',[_vm._v(\"navigator.sendBeacon\")]),_vm._v(\"接受两个参数：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ol',[_c('li',[_vm._v(\"url: 请求的 URL。请求是 POST 请求。\")]),_vm._v(\" \"),_c('li',[_vm._v(\"data: 要发送的数据。 数据类型可以是：ArrayBufferView, Blob,  FormData，Sting。\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"来看一个用\"),_c('code',[_vm._v(\"FormData\")]),_vm._v(\"来传递数据的栗子，你就懂了：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"language-js line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-js\"}},[_c('code',[_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// 创建一个新的 FormData 并添加一个键值对\")]),_vm._v(\"\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"let\")]),_vm._v(\" data \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"=\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"new\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token class-name\"}},[_vm._v(\"FormData\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\";\")]),_vm._v(\"\\ndata\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\".\")]),_c('span',{pre:true,attrs:{\"class\":\"token function\"}},[_vm._v(\"append\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_c('span',{pre:true,attrs:{\"class\":\"token string\"}},[_vm._v(\"'hello'\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\",\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token string\"}},[_vm._v(\"'world'\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\";\")]),_vm._v(\"\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"let\")]),_vm._v(\" result \"),_c('span',{pre:true,attrs:{\"class\":\"token operator\"}},[_vm._v(\"=\")]),_vm._v(\" navigator\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\".\")]),_c('span',{pre:true,attrs:{\"class\":\"token function\"}},[_vm._v(\"sendBeacon\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_c('span',{pre:true,attrs:{\"class\":\"token string\"}},[_vm._v(\"'./src'\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\",\")]),_vm._v(\" data\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\";\")]),_vm._v(\"\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"if\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_vm._v(\"result\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\" \\n  console\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\".\")]),_c('span',{pre:true,attrs:{\"class\":\"token function\"}},[_vm._v(\"log\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_c('span',{pre:true,attrs:{\"class\":\"token string\"}},[_vm._v(\"'请求成功排队 等待执行'\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\";\")]),_vm._v(\"\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"else\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n  console\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\".\")]),_c('span',{pre:true,attrs:{\"class\":\"token function\"}},[_vm._v(\"log\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_c('span',{pre:true,attrs:{\"class\":\"token string\"}},[_vm._v(\"'失败'\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\";\")]),_vm._v(\"\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\"\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"6\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"7\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"8\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"9\")]),_c('br')])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h4',{attrs:{\"id\":\"浏览器支持：\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#浏览器支持：\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" 浏览器支持：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"虽然现在浏览器对\"),_c('code',[_vm._v(\"sendBeacon\")]),_vm._v(\"的支持很好，我们对其做一下兼容性处理也是有必要的：\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"language-js line-numbers-mode\"},[_c('pre',{pre:true,attrs:{\"class\":\"language-js\"}},[_c('code',[_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"if\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"(\")]),_vm._v(\"navigator\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\".\")]),_vm._v(\"sendBeacon\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\")\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n  \"),_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// Beacon 代码\")]),_vm._v(\"\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token keyword\"}},[_vm._v(\"else\")]),_vm._v(\" \"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"{\")]),_vm._v(\"\\n \"),_c('span',{pre:true,attrs:{\"class\":\"token comment\"}},[_vm._v(\"// 回退到 XHR同步请求或者不做处理\")]),_vm._v(\"\\n\"),_c('span',{pre:true,attrs:{\"class\":\"token punctuation\"}},[_vm._v(\"}\")]),_vm._v(\"\\n\")])]),_vm._v(\" \"),_c('div',{staticClass:\"line-numbers-wrapper\"},[_c('span',{staticClass:\"line-number\"},[_vm._v(\"1\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"2\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"3\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"4\")]),_c('br'),_c('span',{staticClass:\"line-number\"},[_vm._v(\"5\")]),_c('br')])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h4',{attrs:{\"id\":\"web-wroker中使用beacon\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#web-wroker中使用beacon\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" web wroker中使用Beacon\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"因为\"),_c('code',[_vm._v(\"Beacon\")]),_vm._v(\"是挂在\"),_c('code',[_vm._v(\"navigator\")]),_vm._v(\"下面，而web worker也有\"),_c('code',[_vm._v(\"navigator\")]),_vm._v(\"，去找了一下，真的给我找到了。\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h4',{attrs:{\"id\":\"beacon其他相关\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#beacon其他相关\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" Beacon其他相关\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ul',[_c('li',[_c('strong',[_vm._v(\"客户端优化：可以将 Beacon 请求合并到其他请求上，一同处理\")]),_vm._v(\", 尤其在移动环境下。\")]),_vm._v(\" \"),_c('li',[_c('strong',[_vm._v(\"Beacon更多的情况是用于做前端埋点，监控用户活动\")]),_vm._v(\"，它的初衷也基于此。\")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h2',{attrs:{\"id\":\"小结\"}},[_c('a',{staticClass:\"header-anchor\",attrs:{\"href\":\"#小结\",\"aria-hidden\":\"true\"}},[_vm._v(\"#\")]),_vm._v(\" 小结\")])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_vm._v(\"本文总共讲了三个API，\"),_c('code',[_vm._v(\"beforeunload\")]),_vm._v(\"、\"),_c('code',[_vm._v(\"unload\")]),_vm._v(\"和\"),_c('code',[_vm._v(\"Beacon\")]),_vm._v(\"，\"),_c('code',[_vm._v(\"Beacon\")]),_vm._v(\"这个API估计知道的人比较少，以后遇到前端埋点和页面卸载前发送请求的需求，记得使用这三个API。\")])}]\n\nexport { render, staticRenderFns }"]}